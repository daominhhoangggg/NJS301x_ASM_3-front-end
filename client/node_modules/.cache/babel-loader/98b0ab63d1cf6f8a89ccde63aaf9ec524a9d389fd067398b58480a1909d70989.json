{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{Link,Redirect}from\"react-router-dom\";import UserAPI from\"../API/UserAPI\";import{addSession}from\"../Redux/Action/ActionSession\";import\"./Auth.css\";import queryString from\"query-string\";import CartAPI from\"../API/CartAPI\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function SignIn(props){//listCart được lấy từ redux\nconst listCart=useSelector(state=>state.Cart.listCart);const[email,setEmail]=useState(\"\");const[password,setPassword]=useState(\"\");// const [user, setUser] = useState({});\nconst[errorEmail,setErrorEmail]=useState(false);const[emailRegex,setEmailRegex]=useState(false);const[errorPassword,setErrorPassword]=useState(false);const[redirect,setRedirect]=useState(false);const[checkPush,setCheckPush]=useState(false);const dispatch=useDispatch();// useEffect(() => {\n//   const fetchData = async () => {\n//     const response = await UserAPI.getAllData();\n//     setUser(response);\n//   };\n//   fetchData();\n// }, []);\nconst onChangeEmail=e=>{setEmail(e.target.value);};const onChangePassword=e=>{setPassword(e.target.value);};const onSubmit=async()=>{if(!email){setErrorEmail(true);return;}else{if(!password){setErrorEmail(false);setErrorPassword(true);return;}else{setErrorPassword(false);if(!validateEmail(email)){setEmailRegex(true);return;}else{setEmailRegex(false);const fetchLogin=async()=>{const params={email:email,password:password};const query=\"?\"+queryString.stringify(params);try{const response=await UserAPI.postLogin(query);setErrorEmail(false);setErrorPassword(false);localStorage.setItem(\"id_user\",response.user._id);localStorage.setItem(\"name_user\",response.user.fullname);localStorage.setItem(\"token\",response.token);const action=addSession(localStorage.getItem(\"id_user\"));dispatch(action);setCheckPush(true);}catch(error){if(error.response.data.error===email){setErrorEmail(true);return;}else{setErrorEmail(false);if(error.response.data.error===password){setErrorPassword(true);return;}}}};fetchLogin();}}}};//Hàm này dùng để đưa hết tất cả carts vào API của user\nuseEffect(()=>{const fetchData=async()=>{//Lần đầu sẽ không thực hiện insert được vì addCart = ''\nif(checkPush===true){for(let i=0;i<listCart.length;i++){//Nó sẽ lấy idUser và idProduct và count cần thêm để gửi lên server\nconst params={idUser:localStorage.getItem(\"id_user\"),idProduct:listCart[i].idProduct,count:listCart[i].count};const query=\"?\"+queryString.stringify(params);const response=await CartAPI.postAddToCart(query);console.log(response);}setRedirect(true);}};fetchData();},[checkPush,listCart]);function validateEmail(email){const re=/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;return re.test(String(email).toLowerCase());}return/*#__PURE__*/_jsx(\"div\",{className:\"limiter\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container-login100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrap-login100 p-l-55 p-r-55 p-t-65 p-b-50\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"login100-form-title p-b-33\",children:\"Sign In\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center pb-5\",children:[emailRegex&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Incorrect Email Format\"}),errorEmail&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Email\"}),errorPassword&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"* Please Check Your Password\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"wrap-input100 validate-input\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input100\",type:\"text\",placeholder:\"Email\",value:email,onChange:onChangeEmail})}),/*#__PURE__*/_jsx(\"div\",{className:\"wrap-input100 rs1 validate-input\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input100\",type:\"password\",placeholder:\"Password\",value:password,onChange:onChangePassword})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container-login100-form-btn m-t-20\",children:[redirect&&/*#__PURE__*/_jsx(Redirect,{to:\"/\"}),/*#__PURE__*/_jsx(\"button\",{className:\"login100-form-btn\",onClick:onSubmit,children:\"Sign in\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center p-t-45 p-b-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"txt1\",children:\"Create an account?\"}),\"\\xA0\",/*#__PURE__*/_jsx(Link,{to:\"/signup\",className:\"txt2 hov1\",children:\"Sign up\"})]})]})})});}export default SignIn;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","Link","Redirect","UserAPI","addSession","queryString","CartAPI","jsx","_jsx","jsxs","_jsxs","SignIn","props","listCart","state","Cart","email","setEmail","password","setPassword","errorEmail","setErrorEmail","emailRegex","setEmailRegex","errorPassword","setErrorPassword","redirect","setRedirect","checkPush","setCheckPush","dispatch","onChangeEmail","e","target","value","onChangePassword","onSubmit","validateEmail","fetchLogin","params","query","stringify","response","postLogin","localStorage","setItem","user","_id","fullname","token","action","getItem","error","data","fetchData","i","length","idUser","idProduct","count","postAddToCart","console","log","re","test","String","toLowerCase","className","children","type","placeholder","onChange","to","onClick"],"sources":["C:/Users/Asus Vivobook/Desktop/Assignment_3/front-end/client/src/Authentication/SignIn.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport UserAPI from \"../API/UserAPI\";\nimport { addSession } from \"../Redux/Action/ActionSession\";\nimport \"./Auth.css\";\nimport queryString from \"query-string\";\nimport CartAPI from \"../API/CartAPI\";\n\nfunction SignIn(props) {\n  //listCart được lấy từ redux\n  const listCart = useSelector((state) => state.Cart.listCart);\n\n  const [email, setEmail] = useState(\"\");\n\n  const [password, setPassword] = useState(\"\");\n\n  // const [user, setUser] = useState({});\n\n  const [errorEmail, setErrorEmail] = useState(false);\n  const [emailRegex, setEmailRegex] = useState(false);\n  const [errorPassword, setErrorPassword] = useState(false);\n\n  const [redirect, setRedirect] = useState(false);\n\n  const [checkPush, setCheckPush] = useState(false);\n\n  const dispatch = useDispatch();\n\n  // useEffect(() => {\n  //   const fetchData = async () => {\n  //     const response = await UserAPI.getAllData();\n\n  //     setUser(response);\n  //   };\n\n  //   fetchData();\n  // }, []);\n\n  const onChangeEmail = (e) => {\n    setEmail(e.target.value);\n  };\n\n  const onChangePassword = (e) => {\n    setPassword(e.target.value);\n  };\n\n  const onSubmit = async () => {\n    if (!email) {\n      setErrorEmail(true);\n      return;\n    } else {\n      if (!password) {\n        setErrorEmail(false);\n        setErrorPassword(true);\n        return;\n      } else {\n        setErrorPassword(false);\n\n        if (!validateEmail(email)) {\n          setEmailRegex(true);\n          return;\n        } else {\n          setEmailRegex(false);\n\n          const fetchLogin = async () => {\n            const params = {\n              email: email,\n              password: password,\n            };\n\n            const query = \"?\" + queryString.stringify(params);\n            try {\n              const response = await UserAPI.postLogin(query);\n\n              setErrorEmail(false);\n              setErrorPassword(false);\n\n              localStorage.setItem(\"id_user\", response.user._id);\n\n              localStorage.setItem(\"name_user\", response.user.fullname);\n\n              localStorage.setItem(\"token\", response.token);\n\n              const action = addSession(localStorage.getItem(\"id_user\"));\n              dispatch(action);\n\n              setCheckPush(true);\n            } catch (error) {\n              if (error.response.data.error === email) {\n                setErrorEmail(true);\n                return;\n              } else {\n                setErrorEmail(false);\n\n                if (error.response.data.error === password) {\n                  setErrorPassword(true);\n                  return;\n                }\n              }\n            }\n          };\n\n          fetchLogin();\n        }\n      }\n    }\n  };\n\n  //Hàm này dùng để đưa hết tất cả carts vào API của user\n  useEffect(() => {\n    const fetchData = async () => {\n      //Lần đầu sẽ không thực hiện insert được vì addCart = ''\n      if (checkPush === true) {\n        for (let i = 0; i < listCart.length; i++) {\n          //Nó sẽ lấy idUser và idProduct và count cần thêm để gửi lên server\n          const params = {\n            idUser: localStorage.getItem(\"id_user\"),\n            idProduct: listCart[i].idProduct,\n            count: listCart[i].count,\n          };\n\n          const query = \"?\" + queryString.stringify(params);\n\n          const response = await CartAPI.postAddToCart(query);\n          console.log(response);\n        }\n\n        setRedirect(true);\n      }\n    };\n\n    fetchData();\n  }, [checkPush, listCart]);\n\n  function validateEmail(email) {\n    const re =\n      /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(String(email).toLowerCase());\n  }\n\n  return (\n    <div className=\"limiter\">\n      <div className=\"container-login100\">\n        <div className=\"wrap-login100 p-l-55 p-r-55 p-t-65 p-b-50\">\n          <span className=\"login100-form-title p-b-33\">Sign In</span>\n\n          <div className=\"d-flex justify-content-center pb-5\">\n            {emailRegex && (\n              <span className=\"text-danger\">* Incorrect Email Format</span>\n            )}\n            {errorEmail && (\n              <span className=\"text-danger\">* Please Check Your Email</span>\n            )}\n            {errorPassword && (\n              <span className=\"text-danger\">* Please Check Your Password</span>\n            )}\n          </div>\n\n          <div className=\"wrap-input100 validate-input\">\n            <input\n              className=\"input100\"\n              type=\"text\"\n              placeholder=\"Email\"\n              value={email}\n              onChange={onChangeEmail}\n            />\n          </div>\n\n          <div className=\"wrap-input100 rs1 validate-input\">\n            <input\n              className=\"input100\"\n              type=\"password\"\n              placeholder=\"Password\"\n              value={password}\n              onChange={onChangePassword}\n            />\n          </div>\n\n          <div className=\"container-login100-form-btn m-t-20\">\n            {redirect && <Redirect to={`/`} />}\n            <button className=\"login100-form-btn\" onClick={onSubmit}>\n              Sign in\n            </button>\n          </div>\n\n          <div className=\"text-center p-t-45 p-b-4\">\n            <span className=\"txt1\">Create an account?</span>\n            &nbsp;\n            <Link to=\"/signup\" className=\"txt2 hov1\">\n              Sign up\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default SignIn;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}